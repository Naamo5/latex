\providecommand{\main}{..}

\documentclass[\main/main.tex]{subfiles}

\begin{document}

\newpage
\appendix
\newpage
\etocdepthtag.toc{mtappendix}
\etocsettagdepth{mtchapter}{none}
\etocsettagdepth{mtappendix}{section}
\etoctocstyle{1}{Appendix - Contents}
\tableofcontents
\newpage

\chapter{Mechanical models}
\label{appendix:models}

\section{Notations and properties}

\subsection{Kinematics wrench}
\label{appendix:notation:wrench}

Considering A, a point of \{2\}, the motion of \{2\} with respect to \{1\} is described by the following wrench:

\begin{equation}
 \{ \mathcal{V}_{2/1} \}
 = \leftidx{_A}{
  \left \{ \begin{array}{c}
  \overrightarrow{\Omega}_{2/1} \\
  \overrightarrow{V}_{A, 2/1}
  \end{array} \right \}
  }{}
\end{equation}

\begin{itemize}
 \item $\overrightarrow{\Omega}_{2/1}$ is the angular velocity of \{2\} with respect to \{1\},
 \item $\overrightarrow{V}_{A, 2/1}$ is the linear velocity of A $\in$ \{2\} with respect to \{1\}.
\end{itemize}

\subsection{Momentum wrench}

Considering A, a point of \{2\}, $m$ its mass and G its the center of mass, the momentum wrench describes the motion of \{2\} with respect to \{1\}:

\begin{equation}
 \{ \mathcal{C}_{2/1} \}
 = \leftidx{_A}{
  \left \{ \begin{array}{ll}
  \overrightarrow{p}_{2/1} & = m \overrightarrow{V}_{G, 2/1} \\
  \overrightarrow{\sigma}_{A, 2/1} &
  = I_{2, A} \ast \overrightarrow{\Omega}_{2/1} + m \overrightarrow{AG} \times \overrightarrow{V}_{A, 2/1}
  \end{array} \right \}
  }{}
\end{equation}

\begin{itemize}
 \item $\overrightarrow{p}_{2/1}$ is the linear momentum of \{2\} with respect to \{1\},
 \item $\overrightarrow{V}_{G, 2/1}$ is the linear velocity of G $\in$ \{2\} with respect to \{1\},
 \item $\overrightarrow{\sigma}_{A, 2/1}$ is the angular momentum of A $\in$ \{2\} with respect to \{1\},
 \item $I_{2, A}$ is the tensor of inertia of \{2\} about the point A.
\end{itemize}

\subsection{Dynamic wrench}

Considering A, a point of \{2\}, its mass $m$ and its center of mass G, the dynamic wrench describes the motion of \{2\} with respect to \{1\}:

\begin{equation}
 \{ \mathcal{D}_{2/1} \}
 = \leftidx{_A}{
  \left \{ \begin{array}{ll}
  \overrightarrow{\mathcal{A}}_{2/1} & = m \overrightarrow{\Gamma}_{G, 2/1} \\
  \overrightarrow{\delta}_{A, 2/1} &
  = \frac{\partial}{\partial t}\overrightarrow{\sigma}_{A, 2/1} + m \overrightarrow{V}_{A/1} \times \overrightarrow{V}_{G, 2/1}
  \end{array} \right \}
  }{}
\end{equation}


\begin{itemize}
 \item $\overrightarrow{\mathcal{A}}_{2/1}$ is the linear dynamic momentum of \{2\} with respect to \{1\},
 \item $\overrightarrow{\Gamma}_{G, 2/1}$ is the acceleration of G $\in$ \{2\} with respect to \{1\},
 \item $\overrightarrow{\delta}_{A, 2/1}$ is the angular dynamic momentum of A $\in$ \{2\} with respect to \{1\},
 \item $\overrightarrow{V}_{A/1}$ is the linear velocity of A with respect to \{1\} (note that A is not necessarily a point of \{2\}).
\end{itemize}

\subsection{Parallel axis theorem}

For an inertia tensor $I_{1, G}$ computed at the center of mass of a rigid body of mass $m$ the tensor for a parallel axis is:

\begin{equation}
 \label{appendix:notation:parallel_axis}
 I_{1, A} = I_{1, G} - m d^2
\end{equation}

with $d$ the skew-symmetric matrix constructed from the vector $\overrightarrow{AG} = \begin{pmatrix}
x \\
y \\
z
\end{pmatrix}$.

{\centering
 $ -d^2 = -\begin{pmatrix}
 0 & -z & y \\
 z & 0 & -x \\
 -y & x & 0
 \end{pmatrix}^2
 = \begin{pmatrix}
 y^2 + z^2 & -xy & -xz \\
 -yx & x^2 + z^2 & -yz \\
 -zx & -zy & x^2 + y^2
 \end{pmatrix}
 = (\overrightarrow{AG}^T \overrightarrow{AG}) \ \mathbb{I}_3 - (\overrightarrow{AG} \overrightarrow{AG}^T)$
 \par}


\subsection{Fondamental Principle of Dynamics}

Considering $\sum_{}^{} \{ \mathcal{V}_{ext/1} \}$ the global external actions on the system \{1\} and $R_g$ a Galilean reference:

\begin{equation}
 \sum_{}^{} \{ \mathcal{V}_{ext/1} \} = \{ \mathcal{D}_{1/R_G} \}
 \label{appendix:notation:fpd}
\end{equation}


\subsection{Notations for systems of linear equations}
\label{notation:matrix}
{\centering
 $ \begin{pmatrix}
  a & 0 & 0 \\
  0 & b & 0 \\
  0 & 0 & c
 \end{pmatrix}
 \coloneqq diag(a, b, c)$
 \par}

{\centering
 $ \theta \times c =
 \begin{pmatrix}
  0         & -\theta_z & \theta_y  \\
  \theta_z  & 0         & -\theta_x \\
  -\theta_y & \theta_x  & 0
 \end{pmatrix}
 \begin{pmatrix}
  c_x \\
  c_y \\
  c_zeq:
 \end{pmatrix}
 \coloneqq \left[ \theta \times \right] c$
 \par}

{\centering
 $ I \ast \theta =
 \begin{pmatrix}
  \theta_x & \theta_y & \theta_z & 0        & 0        & 0        \\
  0        & \theta_x & 0        & \theta_y & \theta_z & 0        \\
  0        & 0        & \theta_x & 0        & \theta_y & \theta_z
 \end{pmatrix}
 \begin{pmatrix}
  I_{xx} \\
  I_{xy} \\
  I_{xz} \\
  I_{yy} \\
  I_{yz} \\
  I_{zz} \\
 \end{pmatrix}
 \coloneqq \left[ \bullet \theta \right]
 \begin{pmatrix}
  I_{xx} \\
  I_{xy} \\
  I_{xz} \\
  I_{yy} \\
  I_{yz} \\
  I_{zz} \\
 \end{pmatrix}$
 \par}

with $I = I^T =
\begin{pmatrix}
 I_{xx} & I_{xy} & I_{xz} \\
 I_{xy} & I_{yy} & I_{yz} \\
 I_{xz} & I_{yz} & I_{zz}
\end{pmatrix}
$.


\subsection{Rotation matrix}
\label{appendix:notation:rotation}

Considering the orientation $\theta =
\begin{pmatrix}
 \theta_x \\
 \theta_y \\
 \theta_z \\
\end{pmatrix}
$,
the corresponding rotation matrix is $R = R_z(\theta_z)R_y(\theta_y)R_x(\theta_x)$ or:

\begin{equation*}
 R =
 \begin{pmatrix}
  \cos \theta_y \cos \theta_z & \sin \theta_x \sin \theta_y \cos \theta_z - \cos \theta_x \sin \theta_z & \cos \theta_x \sin \theta_y \cos \theta_z + \sin \theta_x \sin \theta_z \\
  \cos \theta_y \sin \theta_z & \sin \theta_x \sin \theta_y \sin \theta_z + \cos \theta_x \cos \theta_z & \cos \theta_x \sin \theta_y \sin \theta_z - \sin \theta_x \cos \theta_z \\
  - \sin \theta_y             & \sin \theta_x \cos \theta_y                                             & \cos \theta_x \cos \theta_y
 \end{pmatrix}
\end{equation*}

Considering the small-angle approximation ($\cos \alpha \approx 1$, $\sin \alpha \approx \alpha$ and $\alpha \beta \approx 0$ for small $\alpha$ and $\beta$):

\begin{equation}
 R \approx
 \begin{pmatrix}
  1         & \theta_x \theta_y -\theta_z    & \theta_y + \theta_x \theta_z \\
  \theta_z  & \theta_x \theta_y \theta_z + 1 & \theta_y \theta_z -\theta_x  \\
  -\theta_y & \theta_x                       & 1
 \end{pmatrix}
 \approx
 \begin{pmatrix}
  1         & -\theta_z & \theta_y  \\
  \theta_z  & 1         & -\theta_x \\
  -\theta_y & \theta_x  & 1
 \end{pmatrix}
 = \mathbb{I}_3 + \left[ \theta \times \right]
\end{equation}

\newpage

\section{1-body rigid model of the \{tool + item\} system}
\label{appendix:rigid}

The system considered is a single-body system \{1\} composed of the tool and the item rigidly linked to it. The mass of \{1\} is $m$, its global center of mass is $G$ and the global inertia about the center of mass is $I_{G}$. The F/T sensor measures the force and the torque about the joint $S$.

\subsection{External mechanical actions}

\begin{itemize}
 \item Action of the robotic arm on the last link about the joint $S$:

       {\centering
        $\{ \mathcal{V}_{arm/1} \}
        = \leftidx{_S}{
         \left \{ \begin{array}{c}
         \overrightarrow{F}_{arm/1} = \overrightarrow{f} \\
         \overrightarrow{T}_{S, arm/1} = \overrightarrow{\tau}
         \end{array} \right \}
         }{}$
        \par}

 \item Action of the gravitational force:

       {\centering
        $\{ \mathcal{V}_{grav/1} \}
        = \leftidx{_{G}}{
         \left \{ \begin{array}{c}
         m \overrightarrow{g} \\
         \overrightarrow{0}
         \end{array} \right \}
         }{}
        = \leftidx{_{S}}{
         \left \{ \begin{array}{c}
         m \overrightarrow{g} \\
         m \overrightarrow{SG} \times \overrightarrow{g}
         \end{array} \right \}
         }{}$
        \par}

\end{itemize}

\subsection{Dynamics wrench}
\label{appendix:rigid:dynamic}

Considering the dynamic angular momentum of the system \{1\} about the joint $S$:

{\centering
 $\overrightarrow{\delta}_{S, 1/0}
 = \frac{\partial}{\partial t}\overrightarrow{\sigma}_{S, 1/0} + m \overrightarrow{V}_{S/0} \times \overrightarrow{V}_{G, 1/0}$
 \par}

The angular momentum of the system \{1\} about the joint $S$ is:

{\centering
 $\overrightarrow{\sigma}_{S, 1/0}
 = I_{S} \ast \overrightarrow{\Omega}_{1/0} + m \overrightarrow{SG} \times \overrightarrow{V}_{S, 1/0}$
 \par}

Its time derivative is:

\begin{align*}
 {\left[ \frac{\partial}{\partial t} \overrightarrow{\sigma}_{S, 1/0} \right]}_{R_0} &
 = {\left[ \frac{\partial}{\partial t}  (I_{S} \ast \overrightarrow{\Omega}_{1/0}) \right]}_{R_1}
 + \overrightarrow{\Omega}_{1/0} \times  (I_{S} \ast \overrightarrow{\Omega}_{1/0})
 + m  \frac{\partial}{\partial t} (\overrightarrow{SG} \times \overrightarrow{V}_{S, 1/0} ) \\
                                                                                     & = I_{S} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{S} \ast \overrightarrow{\Omega}_{1/0})
 + m \frac{\partial}{\partial t} (\overrightarrow{SG}) \times \overrightarrow{V}_{S, 1/0}
 + m \overrightarrow{SG} \times  \frac{\partial}{\partial t} (\overrightarrow{V}_{S, 1/0} ) \\
                                                                                     & =  I_{S} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{S} \ast \overrightarrow{\Omega}_{1/0})
 + m  \overrightarrow{V}_{G, 1/0}  \times \overrightarrow{V}_{S, 1/0}
 + m \overrightarrow{SG} \times  \overrightarrow{\Gamma}_{S, 1/0}
\end{align*}

Consequently, the dynamic rotational momentum is:


\begin{align*}
 \overrightarrow{\delta}_{S, 1/0}
 & = I_{1, S} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{1, S} \ast \overrightarrow{\Omega}_{1/0})
 + m \overrightarrow{SG} \times  \overrightarrow{\Gamma}_{S, 1/0}
 && + m  \overrightarrow{V}_{G, 1/0}  \times \overrightarrow{V}_{S, 1/0} \\
   &   &   & + m \overrightarrow{V}_{S/0} \times \overrightarrow{V}_{G, 1/0} \\
 & = I_{1, S} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{1, S} \ast \overrightarrow{\Omega}_{1/0})
 + m \overrightarrow{SG} \times  \overrightarrow{\Gamma}_{S, 1/0}
\end{align*}

Thus the dynamics wrench of the system \{1\} in the in the Galilean reference \{0\} is:

\begin{align*}
 \{ \mathcal{D}_{1/0} \}
 = \leftidx{_{S}}{
 \left \{
 \begin{array}{ll}
 \overrightarrow{\mathcal{A}}_{1/0} & = m \overrightarrow{\Gamma}_{G, 1/0} \\
 \overrightarrow{\delta}_{S, 1/0}   &
 = I_{S} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{S} \ast \overrightarrow{\Omega}_{1/0})
 + m \overrightarrow{SG} \times  \overrightarrow{\Gamma}_{S, 1/0}
 \end{array}
 \right \}
 }{}
\end{align*}

The position –hence, the acceleration– of the center of mass is unknown. The acceleration is computed with the position of the joint $S$.

\begin{align*}
 \overrightarrow{\Gamma}_{G, 1/0} = \frac{\partial}{\partial t} \overrightarrow{V}_{G, 1/0}
   & = \frac{\partial}{\partial t} (\overrightarrow{V}_{S, 1/0} + \overrightarrow{GS} \times \overrightarrow{\Omega}_{1/0})                                                                           \\
   & = \overrightarrow{\Gamma}_{S, 1/0} + \frac{\partial}{\partial t} (\overrightarrow{GS}) \times \overrightarrow{\Omega}_{1/0} + \overrightarrow{GS} \times \overrightarrow{\alpha}_{1/0}           \\
   & = \overrightarrow{\Gamma}_{S, 1/0} + (\overrightarrow{\Omega}_{1/0} \times \overrightarrow{GS}) \times \overrightarrow{\Omega}_{1/0} + \overrightarrow{GS} \times \overrightarrow{\alpha}_{1/0}  \\
   & = \overrightarrow{\Gamma}_{S, 1/0} +  \overrightarrow{\Omega}_{1/0} \times (\overrightarrow{\Omega}_{1/0} \times \overrightarrow{SG}) + \overrightarrow{\alpha}_{1/0} \times \overrightarrow{SG}
\end{align*}

The the dynamics wrench of the system \{1\} becomes:

\begin{align*}
 \{ \mathcal{D}_{1/0} \}
 = \leftidx{_{S}}{
 \left \{
 \begin{array}{ll}
 \overrightarrow{\mathcal{A}}_{1/0} & = m \overrightarrow{\Gamma}_{S, 1/0} +  \overrightarrow{\Omega}_{1/0} \times (\overrightarrow{\Omega}_{1/0} \times m \overrightarrow{SG}) + \overrightarrow{\alpha}_{1/0} \times m \overrightarrow{SG} \\
 \overrightarrow{\delta}_{S, 1/0}   &
 = I_{S} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{S} \ast \overrightarrow{\Omega}_{1/0})
 + m \overrightarrow{SG} \times  \overrightarrow{\Gamma}_{S, 1/0}
 \end{array}
 \right \}
 }{}
\end{align*}

\subsection{\ac{FPD} on \{1\}}

From the equation of the \ac{FPD} (\ref{appendix:notation:fpd}) on \{1\} at point $S$:

\begin{equation*}
 \leftidx{_{S}}{
  \left \{ \begin{array}{c}
  \overrightarrow{f} \\
  \overrightarrow{\tau}
  \end{array} \right \}
  }{}
 + \leftidx{_{S}}{
  \left \{ \begin{array}{c}
  m \overrightarrow{g} \\
  m \overrightarrow{SG} \times \overrightarrow{g}
  \end{array} \right \}
  }{}
 = \leftidx{_{S}}{
  \left \{
  \begin{array}{ll}
   m \overrightarrow{\Gamma}_{S, 1/0} +  \overrightarrow{\Omega}_{1/0} \times (\overrightarrow{\Omega}_{1/0} \times m \overrightarrow{SG}) + \overrightarrow{\alpha}_{1/0} \times m \overrightarrow{SG} \\
   I_{S} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{S} \ast \overrightarrow{\Omega}_{1/0})
   + m \overrightarrow{SG} \times  \overrightarrow{\Gamma}_{S, 1/0}
  \end{array}
  \right \}
  }{}
\end{equation*}

Force and torque at the joint are derived as follows:

\begin{equation}
 \overrightarrow{f} = m (\overrightarrow{\Gamma}_{S, 1/0} - \overrightarrow{g}) + \overrightarrow{\Omega}_{1/0} \times (\overrightarrow{\Omega}_{1/0} \times m \overrightarrow{SG}) + \overrightarrow{\alpha}_{1/0} \times m \overrightarrow{SG}
\end{equation}

\begin{equation}
 \overrightarrow{\tau} =
 m \overrightarrow{SG} \times (\overrightarrow{\Gamma}_{S, 1/0} - \overrightarrow{g})
 + I_{S} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{S} \ast \overrightarrow{\Omega}_{1/0})
\end{equation}

With the aim of shrinking the equation, the following notation are used:

\begin{align*}
 \omega = \overrightarrow{\Omega}_{1/0} \qquad \alpha = \overrightarrow{\alpha}_{1/0} \qquad a = \overrightarrow{\Gamma}_{S, 1/0} \qquad g = \overrightarrow{g} \qquad c  = \overrightarrow{SG} \qquad I = I_{S}
\end{align*}

\begin{equation}
 \label{appendix:eq:rigid}
 \left \{
 \begin{array}{l l}
  f =    & m (a - g) + \omega \times (\omega \times m c) + \alpha \times m c \\
  \tau = & m c \times (a - g)
  + I_{S} \ast \alpha + \omega \times (I_{S} \ast \omega)
 \end{array}
 \right.
\end{equation}

\subsection{Inertial parameters estimation}
\label{appendix:rigid:inertia_estimation}

From the \ac{FPD} equations (\ref{appendix:eq:rigid}) it is possible to isolate the inertial parameters of the item grasped by the tool using the following matrix equation (cf. $\left[ \bullet . \right]$ and $\left[. \times \right]$ notation in Section \ref{notation:matrix}).

\begin{equation}
 \begin{pmatrix}
  f    \\
  \tau
 \end{pmatrix}
 =
 \begin{pmatrix}
  a - g & \left[ \alpha \times \right] +  \left[ \omega \times \right] \left[ \omega \times \right] & 0                                                                                                             \\
  0     & \left[ (a - g) \times \right]                                                                                & \left[ \bullet \alpha \right] + \left[ \omega \times \right] \left[ \bullet \omega \right]
 \end{pmatrix}
 \begin{pmatrix}
  m      \\
  m c_x  \\
  m c_y  \\
  m c_z  \\
  I_{xx} \\
  I_{xy} \\
  I_{xz} \\
  I_{yy} \\
  I_{yz} \\
  I_{zz}
 \end{pmatrix}
\end{equation}

The matrix equation is recorded with the following notation:

\begin{equation}
  \label{appendix:rigid:matrix}
 \begin{pmatrix}
  f    \\
  \tau
 \end{pmatrix}
 = A(a, \alpha, \omega, g) \varphi
\end{equation}

\newpage

\section{Rotational Mass Spring Damper model}
\label{appendix:rmsd}

The F/T sensor measures the force and the torque about the joint $S$.
The system considered is a two-bodies system: \{1\} for the tool and \{2\} for the item grasped. The mass of \{1\} –respectively \{2\}– is $m_1$ –respectively $m_2$, its center of mass is $G_1$ –respectively $G_2$– and the inertia about the center of mass is $I_{1, G_1}$ –respectively $I_{2, G_2}$. The mechanical link between the two systems is modeled as a universal joint –as known as \textsc{Cardan} joint– with a spring-damper system about the transversal axes of the tool (Figure \ref{fig:tikz:two_bodies}). It is also assumed that the tool \{1\} is always vertical which infers that $\overrightarrow{z_1} = -\overrightarrow{z_0}$ and $\overrightarrow{\Omega}_{1/0} = \Omega_{1/0} \overrightarrow{z_0}$.

\subsection{External mechanical actions}

\begin{itemize}
 \item Action of the robotic arm on the tool about the grasping point $A$:

       {\centering
        $\{ \mathcal{V}_{arm/1} \}
        = \leftidx{_S}{
         \left \{ \begin{array}{c}
         \overrightarrow{F}_{arm/1} = \overrightarrow{f} \\
         \overrightarrow{T}_{S, arm/1} = \overrightarrow{\tau}
         \end{array} \right \}
         }{}
        = \leftidx{_A}{
         \left \{ \begin{array}{c}
         \overrightarrow{f} \\
         \overrightarrow{\tau} + \overrightarrow{AS} \times \overrightarrow{f}
         \end{array} \right \}
         }{}$
        \par}

 \item Action of the item \{2\} on the tool \{1\} about the grasp point $A$:

       {\centering
        $\{ \mathcal{V}_{2/1} \}
        = \leftidx{_A}{
         \left \{ \begin{array}{c}
         \overrightarrow{F}_{2/1} \\
         \overrightarrow{T}_{A, 2/1} = N_{2/1} \overrightarrow{z_1}
         \end{array} \right \}
         }{}$
        and respectively
        $\{ \mathcal{V}_{1/2} \}
        = \leftidx{_A}{
         \left \{ \begin{array}{c}
         \overrightarrow{F}_{1/2} = - \overrightarrow{F}_{2/1}  \\
         \overrightarrow{T}_{A, 1/2} = -N_{2/1} \overrightarrow{z_1}
         \end{array} \right \}
         }{}$
        \par}

 \item Action of the gravitational force on \{1\} and on \{2\}:

       {\centering
        $\{ \mathcal{V}_{grav/1} \}
        = \leftidx{_{G_1}}{
         \left \{ \begin{array}{c}
         m_1 \overrightarrow{g} \\
         \overrightarrow{0}
         \end{array} \right \}
         }{}
        = \leftidx{_{A}}{
         \left \{ \begin{array}{c}
         m_1 \overrightarrow{g} \\
         m_1 \overrightarrow{AG_1} \times \overrightarrow{g}
         \end{array} \right \}
         }{}
        $
        \par}

       {\centering
        $ \{ \mathcal{V}_{grav/2} \}
        = \leftidx{_{G_2}}{
         \left \{ \begin{array}{c}
         m_2 \overrightarrow{g} \\
         \overrightarrow{0}
         \end{array} \right \}
         }{}
        = \leftidx{_{A}}{
         \left \{ \begin{array}{c}
         m_2 \overrightarrow{g} \\
         m_2 \overrightarrow{AG_2} \times \overrightarrow{g}
         \end{array} \right \}
         }{}
        $
        \par}

 \item Action of spring-damper system on \{1\} and \{2\} about the grasp point $A$:

       {\centering
        $\{ \mathcal{V}_{spring/1} \}
        + \{ \mathcal{V}_{damper/1} \}
        = \leftidx{_A}{
         \left \{ \begin{array}{c}
         \overrightarrow{0} \\
         K \ast \overrightarrow{\Theta}_{2/1}
         \end{array} \right \}
         }{}
        + \leftidx{_A}{
         \left \{ \begin{array}{c}
         \overrightarrow{0} \\
         \Lambda \ast \overrightarrow{\Omega}_{2/1}
         \end{array} \right \}
         }{}
        = \leftidx{_A}{
         \left \{ \begin{array}{c}
         \overrightarrow{0} \\
         K \ast \overrightarrow{\Theta}_{2/1} + \Lambda \ast \overrightarrow{\Omega}_{2/1}
         \end{array} \right \}
         }{}$
        \par}

       {\centering
        $\{ \mathcal{V}_{spring/2} \}
        + \{ \mathcal{V}_{damper/2} \}
        = \leftidx{_A}{
         \left \{ \begin{array}{c}
         \overrightarrow{0} \\
         K \ast \overrightarrow{\Theta}_{1/2} + \Lambda \ast \overrightarrow{\Omega}_{1/2}
         \end{array} \right \}
         }{}$
        \par}

       with $K =
       \begin{pmatrix}
        k & 0 & 0 \\
        0 & k & 0 \\
        0 & 0 & 0
       \end{pmatrix}
       $
       and
       $\Lambda =
       \begin{pmatrix}
         \lambda & 0 & 0 \\
         0 & \lambda & 0 \\
         0 & 0 & 0
       \end{pmatrix}
       $.

\end{itemize}

\subsection{Dynamics wrench}

By using the equations derived in \ref{appendix:rigid:dynamic}, the dynamic wrenches of \{1\} and \{2\} are:

\begin{align*}
 \{ \mathcal{D}_{1/0} \}
 = \leftidx{_{A}}{
 \left \{
 \begin{array}{ll}
 \overrightarrow{\mathcal{A}}_{1/0} & = m_1 \overrightarrow{\Gamma}_{A, 1/0} +  \overrightarrow{\Omega}_{1/0} \times (\overrightarrow{\Omega}_{1/0} \times m_1 \overrightarrow{AG_1}) + \overrightarrow{\alpha}_{1/0} \times m_1 \overrightarrow{AG_1} \\
 \overrightarrow{\delta}_{A, 1/0}   &
 = I_{1, A} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{1, A} \ast \overrightarrow{\Omega}_{1/0})
 + m_1 \overrightarrow{AG_1} \times  \overrightarrow{\Gamma}_{A, 1/0}
 \end{array}
 \right \}
 }{}
\end{align*}

\begin{align*}
 \{ \mathcal{D}_{2/0} \}
 = \leftidx{_{A}}{
 \left \{
 \begin{array}{ll}
 \overrightarrow{\mathcal{A}}_{2/0} & = m_2 \overrightarrow{\Gamma}_{A, 2/0} +  \overrightarrow{\Omega}_{2/0} \times (\overrightarrow{\Omega}_{2/0} \times m_2 \overrightarrow{AG_2}) + \overrightarrow{\alpha}_{2/0} \times m_2 \overrightarrow{AG_2} \\
 \overrightarrow{\delta}_{A, 2/0}   &
 = I_{2, A} \ast \overrightarrow{\alpha}_{2/0} + \overrightarrow{\Omega}_{2/0} \times (I_{2, A} \ast \overrightarrow{\Omega}_{2/0})
 + m_2 \overrightarrow{AG_2} \times  \overrightarrow{\Gamma}_{A, 2/0}
 \end{array}
 \right \}
 }{}
\end{align*}

\subsection{\ac{FPD} on \{1\}}
\label{appendix:rmsd:fpd1}

From the equation of the \ac{FPD} (\ref{appendix:notation:fpd}) on \{1\} at point A:

\begin{align*}
   & \leftidx{_A}{
 \left \{ \begin{array}{c}
 \overrightarrow{f} \\
 \overrightarrow{\tau} + \overrightarrow{AS} \times \overrightarrow{f}
 \end{array} \right \}
 }{}
 + \leftidx{_A}{
 \left \{ \begin{array}{c}
 \overrightarrow{F}_{2/1} \\
 N_{2/1} \overrightarrow{z_1}
 \end{array} \right \}
 }{}
 + \leftidx{_{A}}{
 \left \{ \begin{array}{c}
 m_1 \overrightarrow{g} \\
 m_1 \overrightarrow{AG_1} \times \overrightarrow{g}
 \end{array} \right \}
 }{}
 + \leftidx{_A}{
 \left \{ \begin{array}{c}
 \overrightarrow{0} \\
 K \ast \overrightarrow{\Theta}_{2/1} + \Lambda \ast \overrightarrow{\Omega}_{2/1}
 \end{array} \right \}
 }{} \\
 = & \leftidx{_{A}}{
 \left \{
 \begin{array}{cc}
 m_1 \overrightarrow{\Gamma}_{A, 1/0} +  \overrightarrow{\Omega}_{1/0} \times (\overrightarrow{\Omega}_{1/0} \times m_1 \overrightarrow{AG_1}) + \overrightarrow{\alpha}_{1/0} \times m_1 \overrightarrow{AG_1} \\
 I_{1, A} \ast \overrightarrow{\alpha}_{1/0} + \overrightarrow{\Omega}_{1/0} \times (I_{1, A} \ast \overrightarrow{\Omega}_{1/0})
 + m_1 \overrightarrow{AG_1} \times  \overrightarrow{\Gamma}_{A, 1/0}
 \end{array}
 \right \}
 }{}
\end{align*}

From the \ac{FPD} on \{1\}, the force $F_{2/1}$ acting on \{1\} by \{2\} can derived (cf. equation \ref{eq:appendix:fpd1-force}).

\begin{equation}
  \label{eq:appendix:fpd1-force}
  \overrightarrow{F}_{2/1} = m_1 (\overrightarrow{\Gamma}_{A, 1/0} - \overrightarrow{g}) - \overrightarrow{f} + \overrightarrow{\Omega}_{1/0} \times (\overrightarrow{\Omega}_{1/0} \times m_1 \overrightarrow{AG_1}) + \overrightarrow{\alpha}_{1/0} \times m_1 \overrightarrow{AG_1}
\end{equation}

Subsequently, only the projection on $\overrightarrow{x_0}$ and $\overrightarrow{y_0}$ of the torque equation is considered. The orientation of \{2\} w.r.t.\ \{1\} ($\overrightarrow{\Theta}_{2/1}$) and the angular velocity ($\overrightarrow{\Omega}_{2/1}$) can be further computed from the tools inertial parameters and the kinetic measurements.

\subsection{\ac{FPD} on \{2\}}
\label{appendix:rmsd:fpd2}

From the equation of the \ac{FPD} (\ref{appendix:notation:fpd}) on \{2\} at point $A$:

\begin{align*}
   & \leftidx{_A}{
 \left \{ \begin{array}{c}
 -\overrightarrow{F}_{2/1} \\
 - N_{2/1} \overrightarrow{z_1}
 \end{array} \right \}
 }{}
 + \leftidx{_{A}}{
 \left \{ \begin{array}{c}
 m_2 \overrightarrow{g} \\
 m_2 \overrightarrow{AG_2} \times \overrightarrow{g}
 \end{array} \right \}
 }{}
 + \leftidx{_A}{
 \left \{ \begin{array}{c}
 \overrightarrow{0} \\
 K \ast \overrightarrow{\Theta}_{1/2} + \Lambda \ast \overrightarrow{\Omega}_{1/2}
 \end{array} \right \}
 }{} \\
 = & \leftidx{_{A}}{
 \left \{
 \begin{array}{ll}
 m_2 \overrightarrow{\Gamma}_{A, 2/0} +  \overrightarrow{\Omega}_{2/0} \times (\overrightarrow{\Omega}_{2/0} \times m_2 \overrightarrow{AG_2}) + \overrightarrow{\alpha}_{2/0} \times m_2 \overrightarrow{AG_2} \\
 I_{2, A} \ast \overrightarrow{\alpha}_{2/0} + \overrightarrow{\Omega}_{2/0} \times (I_{2, A} \ast \overrightarrow{\Omega}_{2/0})
 + m_2 \overrightarrow{AG_2} \times  \overrightarrow{\Gamma}_{A, 2/0}
 \end{array}
 \right \}
 }{}
 \end{align*}

 With the aim of shrinking the equation, the following notations are used (cf. Section \ref{notation:matrix}):

 \begin{align*}
 \mathcal{M}_1&= [\overrightarrow{\Omega}_{1/0} \times] [\overrightarrow{\Omega}_{1/0} \times] + [\overrightarrow{\alpha}_{1/0} \times] &
 \mathcal{M}_2&= [\overrightarrow{\Omega}_{2/0} \times] [\overrightarrow{\Omega}_{2/0} \times] + [\overrightarrow{\alpha}_{2/0} \times] \\
 \mathcal{N}_1&=  [\bullet \overrightarrow{\alpha}_{1/0}] + [\overrightarrow{\Omega}_{1/0} \times] [\bullet \overrightarrow{\Omega}_{1/0}] &
\mathcal{N}_2&=  [\bullet \overrightarrow{\alpha}_{2/0}] + [\overrightarrow{\Omega}_{2/0} \times] [\bullet \overrightarrow{\Omega}_{2/0}] \\
c_1 &= R_{10} \overrightarrow{AG_1} \qquad c_2 = R_{20} \overrightarrow{AG_2} & g&= \overrightarrow{g}\\
I_1 &= I_{1,A} \qquad I_2 = I_{2,A} & a&= \overrightarrow{\Gamma}_{A, 1/0} = \overrightarrow{\Gamma}_{A, 2/0}
 \end{align*}

Note that the centers of mass $c_1$ and $c_2$ are constant vectors since they are expressed in the tool or item frame ($R_{ij}$ is the rotation to frame i from frame j).  The expression of the force applied on the tool $\overrightarrow{F}_{2/1}$ is substituted in the forces equation as well as spring-damper action $K \ast \overrightarrow{\Theta}_{1/2} + \Lambda \ast \overrightarrow{\Omega}_{1/2}$ (cf. \ref{eq:appendix:fpd2}).

\begin{equation}
 \label{eq:appendix:fpd2}
 \left \{
 \begin{array}{l l}
  f - m_1 (a - g) -  m_1 \mathcal{M}_1 R_{01} c_1 = m_2 (a - g) + m_2 \mathcal{M}_2 R_{02} c_2 \\
  \tau + \overrightarrow{AS} \times f - \mathcal{N}_1 I_1 + m_1 R_{01} c_1 \times (g - a)
  = \mathcal{N}_2 I_2  + m_2 R_{02} c_2 \times  (a - g)
 \end{array}
 \right.
\end{equation}

\subsection{Inertial parameters estimation}
\label{appendix:msd:inertia_estimation}

Along the same lines of the rigid model section (Section \ref{appendix:rigid}). The equations of the system are derived in a matrix form.

The pseudo-force $f'$ and pseudo-torque $\tau'$ are set (cf. \ref{eq:appendix:pseudo}) to be able to write the matrix equation in the same manner as for the rigid model.

\begin{equation}
 \label{eq:appendix:pseudo}
 \left \{
 \begin{array}{l l}
   f' &= f - m_1 (a - g) -  m_1 \mathcal{M}_1 R_{01} c_1 \\
   \tau' &= \tau + \overrightarrow{AS} \times f - \mathcal{N}_1 I_1 + m_1 R_{01} c_1 \times (g - a)
 \end{array}
 \right.
\end{equation}

\begin{equation}
  \label{eq:appendix:rmsd_inertia_estimation}
\begin{pmatrix}
  f' \\ \tau'
\end{pmatrix} = A' \varphi_2
\end{equation}

with $A' = \begin{pmatrix}
  a - g & \mathcal{M}_2 R_{02} & 0\\
  0 & [(a - g) \times] R_{02} & \mathcal{N}_2
\end{pmatrix}$

\subsection{Particular case of the a plane \ac{RMSD} system}
 \label{appendix:plane-rmsd}

Considering the following assumptions (cf. Figure \ref{fig:tikz:two_bodies} for details):

\begin{itemize}

 \item A 2-dimensions problem is considered: $\overrightarrow{\Omega}_{2/0} =
       \begin{pmatrix}
        \dot{\theta} \\
        0            \\
        0
       \end{pmatrix}$ and $\overrightarrow{V}_{G_2, 2/0} =
       \begin{pmatrix}
        0      \\
        v_{2y} \\
        v_{2z}
       \end{pmatrix}$.

 \item The excitation is in the $yz$-plane: $\overrightarrow{\Omega}_{1/0} = \overrightarrow{0}$ and $\overrightarrow{V}_{A, 2/0}
       =
       \begin{pmatrix}
        0      \\
        v_{1y} \\
        v_{1z}
       \end{pmatrix}$
       and $\overrightarrow{\Gamma}_{A, 2/0}
       =
       \begin{pmatrix}
        0      \\
        a_y \\
        a_z
       \end{pmatrix}$.

 \item The initial position is: $\theta_1 =
       \begin{pmatrix}
        \pi \\
        0 \\
        0
       \end{pmatrix}$, $\theta_2 =
       \begin{pmatrix}
        \pi \\
        0 \\
        0
       \end{pmatrix}$, $c_{2, init} =
       \begin{pmatrix}
        0 \\
        0 \\
        -c
       \end{pmatrix}$ with $c > 0$, $\overrightarrow{AS} =
       \begin{pmatrix}
        0  \\
        0  \\
        s
       \end{pmatrix}$ with $s > 0$ and $\overrightarrow{AG_1} =
       \begin{pmatrix}
        0  \\
        0  \\
        q
       \end{pmatrix}$ with $q > 0$.

\end{itemize}

Hence, the torque equation (\ref{eq:appendix:fpd2}) is projected on the $x$-axis:

\begin{equation*}
 \ddot{\theta} + \frac{\lambda}{I_{2xx}} \dot{\theta} + \frac{k + m_2 c (a_z + g)}{I_{2xx}} \theta = - \frac{m_2 c}{I_{2xx}} a_y
\end{equation*}

The solution parameters of $\theta$ can be computed with the measured force $f$. From the \ac{FPD} on \{1\} (\ref{appendix:rmsd:fpd1}), the force equation within the assumptions becomes:

\begin{gather}
  \label{appendix:rmsd:eq:fpd1}
 \overrightarrow{f} = m_1 (\overrightarrow{a} - \overrightarrow{g}) - \overrightarrow{F_{2/1}} \\
 \overrightarrow{f} = m_1
 \begin{pmatrix}
  0  \\
  a_y  \\
  a_z + g
 \end{pmatrix}
 - \begin{pmatrix}
 F_x \\
 F_y \\
 F_z
 \end{pmatrix}
 = \begin{pmatrix}
 - F_x \\
 m_1 a_y - F_y \\
 m_1 (a_z + g) - F_z
 \end{pmatrix}
\end{gather}

% Substituting the force $\overrightarrow{f}$ into the torque equation projected on the $x$-axis:
%
% \begin{gather*}
%  \tau_x + s (m_1 a - F_y) + k \theta + \lambda \dot{\theta} = m_1 q a \\
%  - s F_y + k \theta + \lambda \dot{\theta} = m_1 a (q - s) - \tau_x
% \end{gather*}

Then using the force equation of the \ac{FPD} on \{2\}:

\begin{gather*}
  \begin{pmatrix}
  - F_x \\
  - F_y \\
  - F_z
  \end{pmatrix}
  +
  \begin{pmatrix}
  0 \\
  0 \\
  -m_2 g
  \end{pmatrix}
  = m_2
  \left[
  \begin{pmatrix}
  0 \\
  a_y \\
  a_z
  \end{pmatrix}
  +
  \begin{pmatrix}
  \dot{\theta} \\
  0 \\
  0
  \end{pmatrix}
  \times
  \left(
  \begin{pmatrix}
  \dot{\theta} \\
  0 \\
  0
  \end{pmatrix}
  \times
  \begin{pmatrix}
  0 \\
  -\theta c \\
  c
  \end{pmatrix}
  \right)
  +
  \begin{pmatrix}
  \ddot{\theta} \\
  0 \\
  0
  \end{pmatrix}
  \times
  \begin{pmatrix}
  0 \\
  -\theta c \\
  c
  \end{pmatrix}
  \right] \\
  \begin{pmatrix}
  - F_x \\
  - F_y \\
  - F_z
  \end{pmatrix}
  =
  \begin{pmatrix}
  0 \\
  m_2 [a_y + c (\dot{\theta}^2 \theta - \ddot{\theta})] \\
  m_2 [a_z + g + c (\dot{\theta}^2 + \ddot{\theta} \theta)]
  \end{pmatrix}
\end{gather*}


$F_x$, $F_y$ and $F_z$ are substituted in~\eqref{appendix:rmsd:eq:fpd1}:

\begin{equation}
  \label{force_2d}
  \overrightarrow{f}
  =
  \begin{pmatrix}
  0 \\
  m_1 a_y + m_2 [a_y + c (\dot{\theta}^2 \theta - \ddot{\theta})] \\
  m_1 (a_z + g) + m_2 [a_z + g + c (\dot{\theta}^2 + \ddot{\theta} \theta)]
  \end{pmatrix}
\end{equation}

\underline{Estimation with a sinusoidal trajectory}

In order to estimate $\lambda$ and $k$, the motion of the point A is sinusoidal: $\overrightarrow{OA} = \alpha \sin(\omega t) \cdot \overrightarrow{y_0}$

\begin{equation}
 \label{1d}
 \ddot{\theta}(t) + \frac{\omega_0}{Q} \dot{\theta}(t) + \omega_0^2 \theta(t) = B \sin(\omega t)
\end{equation}

with $\omega_0 = \sqrt{\frac{k + m_2 c g}{I_{2xx}}}$, $Q = \frac{\omega_0 I_{xx}}{\lambda}$ and $B = -\frac{m_2 c \omega^2 \alpha}{I_{2xx}}$.

The solution of (\ref{1d}) is then:


\begin{equation}
  \label{theta2d}
  \theta(t) = \theta_m \sin(\omega t + \phi)
\end{equation}


with:
{\centering
 \begin{tabular}{cc}
  $\theta_m = \frac{B}{\sqrt{{(\omega_0^2 - \omega^2)}^2 + {\left( \frac{\omega \omega_0}{Q}\right)}^2}}$
    & $\phi = - \frac{\pi}{2} - \arctan \left[ Q \left( \frac{\omega}{\omega_0} - \frac{\omega_0}{\omega} \right) \right] $ \\
 \end{tabular}
 \par}

\vspace{0.5cm}

Finally, the equation~\eqref{theta2d} is substituted into the previous~\eqref{force_2d} with $a_z = 0$:

\begin{equation*}
  \begin{pmatrix}
  f_x \\
  f_y \\
  f_z
  \end{pmatrix}
  =
  \begin{pmatrix}
  0 \\
  (m_1 + m_2) a_y + m_2 c \theta_m \omega^2 \sin(\omega t + \phi) (\theta_m^2 \cos^2(\omega t + \phi) + 1)  \\
  (m_1 + m_2) g + m_2 c \theta_m^2 \omega^2
  \end{pmatrix}
\end{equation*}

Considering small-angle  approximation, $\theta_m^2 \cos^2(\omega t + \phi) + 1 \approx 1$ leads to:

\begin{equation}
  \begin{pmatrix}
  f_x \\
  f_y \\
  f_z
  \end{pmatrix}
  =
  \begin{pmatrix}
  0 \\
  (m_1 + m_2) a_y + m_2 c \theta_m \omega^2 \sin(\omega t + \phi) \\
  (m_1 + m_2) g + m_2 c \theta_m^2 \omega^2
  \end{pmatrix}
\end{equation}



The parameters $\theta_m$ and $\phi$ can be derived and spring-damper parameters ($k$ and $\lambda$) are further computed with equations~\eqref{1d} and~\eqref{theta2d}:

\begin{align}
  \theta_m = \frac{\sqrt{f_x + (m1 + m2) g}}{ \omega \sqrt{m_2 c}} &&
  \phi = - \omega t + \arcsin \left( \frac{f_y - a_y (m1 - m2)}{c m_2 \omega^2 \theta_m} \right)
\end{align}

\end{document}
